@startuml
actor User
participant CLI
participant Robot
participant Environment
participant Navigation
participant Manipulator
participant MemoryStore
User -> CLI : type "pick bottle"
CLI -> CLI : enqueue(Command)
CLI -> Robot : deliver(Command)
Robot -> Environment : sense()
Environment --> Robot : sensor snapshot
alt battery < 10%
  Robot --> CLI : "Low battery â€“ please charge"
else
  Robot -> Navigation : planPath(target)
  Navigation --> Robot : path planned
  loop while (not atTarget and timeout < 1000)
    Robot -> Navigation : nextStep()
    Navigation --> Robot : Waypoint or null
  end
  alt no path or timeout
    Robot -> CLI : "No path to target"
    Robot -> Robot : setStateToError()
  else
    Robot -> Manipulator : pick(objectId)
    Manipulator --> Robot : success/fail
    alt success
      Robot -> MemoryStore : pushAction(PICK)
      Robot -> CLI : "OK: picked"
      Robot -> Robot : setStateToIdle()
    else
      Robot -> CLI : "Grasp failed"
      Robot -> Robot : setStateToError()
      Robot -> MemoryStore : undoLastAction
      Robot -> Robot : setStateToIdle()
    end
  end
end
@enduml